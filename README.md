# Equity Explorer (AKA Equitable Development Data Explorer)

### Setup
1.  Install project **node version listed in .nvmrc**
```
git  clone git@github.com:NYCPlanning/equity-tool.git
cd equity-tool
npm i
```

This command should install all necessary dependencies and set up Husky to run on all commits

2. Create `.env.local` and set the required environment variables.
   - Local development credentials are available within the NYC planning password vault under "EDDE Credentials"


### Running locally
To run the Nextjs dev server, run:
```
npm run dev
```

You can also run unit tests or the linter by running `npm run test` or `npm run lint`, respectively.


### Data updates

#### Testing data updates
When iterating through data updates, serving the files locally can help accelerate the verification process.
For this purpose, this repository provides an optional local environment to replicate s3.

To use this environment
- obtain the configuration files, either by running the script in the `ose-equity-tool-etl` repository or downloading them from the Digital Ocean Space
   - Follow the steps for the desired strategy below
- Copy the files into the `localstack/configs/[etl-tag]` folder
- update the `NEXT_PUBLIC_DO_SPACE_URL` variable to point to `http://localhost:4566/configs/[etl-tag]`
   - If already running the frontend, restart the application to use the updated DO_SPACE_URL.
- run `ETL_TAG=[etl-tag] docker compose up`

The files will be automatically loaded to, and served from, the local s3 emulator.

##### Copying files from Digital Ocean
1. Download the folder at the target etl-tag
2. Unzip the folder if necessary.
3. Copy the etl-tag folder and its contents into the `localstack/configs` directory 
4. The resulting directory should follow the form `localstack/configs/[etl-tag]`

##### Copying files from the `ose-equity-tool-etl` repository
Before performing the steps below, ensure the steps to generate data at a specific tag have been performed in the ose-equity-tool-etl repository

Set the ETL_TAG environment variable 
```sh
ETL_TAG=[etl-tag]
```

Create a directly in the localstack config folder
```sh
mkdir localstack/configs/$ETL_TAG
```

Copy the files from the etl repository
```sh
cp path/to/ose-equity-tool-etl/output/*.json localstack/configs/$ETL_TAG
```

Set the url for application to point to
```sh
cat > .env.local << EOF
NEXT_PUBLIC_DO_SPACE_URL=http://localhost:4566/configs/$ETL_TAG
EOF
```

Run the localstack server at the specific tag
```sh
ETL_TAG=$ETL_TAG docker compose up
```


### Tests
Run the suite of Jest tests under `/test`
```
npm run test
```

### 
The data powering this app is generated by this ETL workflow:
https://github.com/NYCPlanning/ose-equity-tool-etl

## Attribution

This project was originally bootstrapped via `create-next-app` using the `with-chakra-ui-typescript` preset

Additional project boilerplate and configuration was drawn from:
* https://github.com/Lukazovic/nextjs-with-chakra-ui-boilerplate
* https://github.com/tim-richter/next-boiler
